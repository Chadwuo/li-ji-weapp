"use strict";var e=t(require("./service"));function t(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return a(e)||r(e,t)||l(e,t)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw a}}return o}}function a(e){if(Array.isArray(e))return e}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function l(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function l(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;c(this,l),this.component=e,this.serviceNameOrder=0,this.weekStart=t,this.bindServices(),this.initToday()}return s(l,[{key:"bindInstance",value:function(e){this.component=e}},{key:"bindServices",value:function(){var n=this;this.services=Array.isArray(e.default)?e.default.filter(function(e){return l.NeedRegist(e,n.component)}).map(function(e){var t=e.name,e=e.handle;return{name:t||n.getServiceOrderName(),handle:e}}):l.NeedRegist(e.default,this.component)?[{name:e.default.name||this.getServiceOrderName(),handle:e.default.handle}]:[]}},{key:"regist",value:function(e){var t=e.name,e=e.handle;"function"==typeof e&&(t=t||this.getServiceOrderName(),this.services.push({name:t,handle:e}))}},{key:"getServiceOrderName",value:function(){var e="service_".concat(this.serviceNameOrder);return this.serviceNameOrder++,e}},{key:"serviceHandle",value:function(e){var t,n=o(this.services);try{for(n.s();!(t=n.n()).done;){var r=t.value;e[r.name]=r.handle(e,this.component)}}catch(e){n.e(e)}finally{n.f()}return e}},{key:"date",value:function(e){var t=e.year,n=e.month,r=e.day,a=this._today,o=a.year,i=a.month,u=a.day,a=new Date(t,n-1,r),t=a.getFullYear(),n=a.getMonth()+1,r=a.getDate(),a=a.getDay();return this.serviceHandle(Object.assign({},e,{year:t,month:n,day:r,week:a,week_name:l.Weeks[a],today:t===o&&n===i&&r===u,key:"d_".concat(t,"_").concat(n,"_").concat(r)}))}},{key:"initToday",value:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),e=e.getDay();this._today=this.serviceHandle({year:t,month:n,day:r,week:e,week_name:l.Weeks[e],today:!0})}},{key:"today",value:function(){return this._today}},{key:"monthBefore",value:function(e){var n=this,r=e.year,a=e.month,e=e.week,e=Math.abs(e+7-this.weekStart)%7;return Array.apply(null,{length:e}).map(function(e,t){return n.date({year:r,month:a,day:-t,state:"prev"})}).reverse()}},{key:"monthAfter",value:function(e){var n=this,r=e.year,a=e.month,o=e.day,e=e.week,e=6-Math.abs(e+7-this.weekStart)%7;return Array.apply(null,{length:e}).map(function(e,t){return n.date({year:r,month:a,day:o+t+1,state:"next"})})}},{key:"month",value:function(n,r){var a=this;return Array.apply(null,{length:l.MonthDays(n,r)}).map(function(e,t){return a.date({year:n,month:r,day:t+1,state:""})})}},{key:"suppleMonth",value:function(e,t){t=this.month(e,t);return{count:t.length,days:this.monthBefore(t[0]).concat(t).concat(this.monthAfter(t[t.length-1]))}}}],[{key:"NeedRegist",value:function(e,t){return"function"==typeof e.handle&&(!e.hasOwnProperty("regist")||("function"==typeof e.regist?e.regist(t):!!e.regist))}},{key:"ResortWeeks",value:function(e){return l.Weeks.slice(e)+l.Weeks.slice(0,e)}},{key:"NormalDate",value:function(e,t,n){n=new Date(e,t-1,n);return{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()}}},{key:"CorrectDate",value:function(){if(1===arguments.length){if("string"==typeof arguments[0]){var e=arguments[0].split("-").map(function(e){return parseInt(e)});if(e.length<3){var t=new Date(e[0]);return isNaN(t.getTime())?null:{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()}}return l.NormalDate(e[0],e[1],e[2])}if("number"==typeof arguments[0]){var n=new Date(arguments[0]);return isNaN(n.getTime())?null:{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()}}if(Array.isArray(arguments[0])){if(arguments[0].length<3)return null;t=u(arguments[0],3),e=t[0],n=t[1],t=t[2];return l.NormalDate(e,n,t)}if("object"===i(arguments[0])){var r=arguments[0],a=r.year,o=r.month,r=r.day;return a&&o&&r?l.NormalDate(a,o,r):null}}else if(3===arguments.length){a=Array.prototype.slice.call(arguments),o=u([a[0],a[1],a[2]].map(function(e){return parseInt(e)}),3),r=o[0],a=o[1],o=o[2];return l.NormalDate(r,a,o)}return null}},{key:"WeekOrder",value:function(e){var t=e.year,n=e.month,e=e.day,e=new Date(t,n-1,e),t=new Date(t,0,1),e=Math.round((e.valueOf()-t.valueOf())/864e5);return Math.ceil((e+(t.getDay()+1-1))/7)}},{key:"DateDiff",value:function(e,t){e=new Date(e.year,e.month-1,e.day),t=new Date(t.year,t.month-1,t.day);return Math.floor((t.getTime()-e.getTime())/864e5)}},{key:"WeekFirstDay",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=e.year,r=e.month,e=e.day,r=new Date(n,r-1,e),e=r.getDay(),t=new Date(r.getFullYear(),r.getMonth(),r.getDate()-Math.abs(e+7-t)%7);return{year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()}}}]),l}();h(m,"Weeks","日一二三四五六"),h(m,"MonthDays",function(e,t){return new Date(e,t,0).getDate()}),module.exports=m;